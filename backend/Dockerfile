# ğŸ—ï¸ ë©€í‹° ìŠ¤í…Œì´ì§€ ë¹Œë“œë¡œ ìµœì í™”ëœ í”„ë¡œë•ì…˜ ì´ë¯¸ì§€ ìƒì„±
FROM eclipse-temurin:21-jdk AS builder

WORKDIR /app

# ğŸ“¦ ì˜ì¡´ì„± íŒŒì¼ë“¤ì„ ë¨¼ì € ë³µì‚¬ (ìºì‹œ ìµœì í™”)
COPY build.gradle settings.gradle ./
COPY gradle gradle
COPY gradlew ./

# ğŸ”§ gradlew ì‹¤í–‰ ê¶Œí•œ ë¶€ì—¬
RUN chmod +x ./gradlew

# ğŸ“¥ ì˜ì¡´ì„± ë‹¤ìš´ë¡œë“œ (ì˜ì¡´ì„±ì´ ë³€ê²½ë˜ì§€ ì•Šìœ¼ë©´ ìºì‹œ ì¬ì‚¬ìš©)
RUN ./gradlew dependencies --no-daemon

# ğŸ“ ì†ŒìŠ¤ ì½”ë“œ ë³µì‚¬ ë° ë¹Œë“œ
COPY src src
RUN ./gradlew build -x test --no-daemon

# ğŸš€ ëŸ°íƒ€ì„ ìŠ¤í…Œì´ì§€
FROM eclipse-temurin:21-jre-alpine

WORKDIR /app

# ğŸ“‹ ë¹Œë” ìŠ¤í…Œì´ì§€ì—ì„œ ë¹Œë“œëœ JAR íŒŒì¼ ë³µì‚¬
COPY --from=builder /app/build/libs/afterschool-0.0.1-SNAPSHOT.jar app.jar

EXPOSE 8080

# âš¡ Spring Boot ì• í”Œë¦¬ì¼€ì´ì…˜ ì‹¤í–‰
ENTRYPOINT ["java", "-jar", "app.jar"]